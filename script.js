// 1. –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp API
const tg = window.Telegram.WebApp;
tg.expand(); // –†–∞—Å—à–∏—Ä—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

// 2. –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç <video> –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ‚Äî –≤ –Ω—ë–º –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–º–µ—Ä–∞
const videoElement = document.getElementById('video');

// 3. –û–±—ä—è–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é startDance, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å —Ç–∞–Ω–µ—Ü"
async function startDance() {
  // 4. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–¥–Ω–µ–π –∫–∞–º–µ—Ä–µ
  const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });

  // 5. –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –∏–∑ –∫–∞–º–µ—Ä—ã –∫ –Ω–∞—à–µ–º—É –≤–∏–¥–µ–æ—ç–ª–µ–º–µ–Ω—Ç—É
  videoElement.srcObject = stream;
  // 3. –ñ–¥—ë–º, –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ–º play()
  videoElement.onloadedmetadata = async () => {
  videoElement.play();
  videoElement.style.display = "block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
};

  // 6. –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç MediaPipe Pose ‚Äî —ç—Ç–æ –ò–ò, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ª–∞
 const pose = new Pose({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${file}`
});

  // 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è MediaPipe ‚Äî –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ, —Ç–æ—á–Ω–æ—Å—Ç—å, –∏ —Ç.–¥.
  pose.setOptions({
    modelComplexity: 1, // 0 (–ª–µ–≥–∫–∏–π), 1 (—Å—Ä–µ–¥–Ω–∏–π), 2 (—Ç—è–∂—ë–ª—ã–π) ‚Äî –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å
    smoothLandmarks: true, // –°–≥–ª–∞–∂–∏–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è
    enableSegmentation: false, // –ù–∞–º —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å
    minDetectionConfidence: 0.5, // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —á—Ç–æ–±—ã –∑–∞—Å—á–∏—Ç–∞—Ç—å —Ç–æ—á–∫—É
    minTrackingConfidence: 0.5 // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
  });

  // 8. –ö–æ–≥–¥–∞ Pose –Ω–∞—à—ë–ª –ø–æ–∑—É ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è
  pose.onResults(results => {
    // 9. –í —ç—Ç–æ–º –æ–±—ä–µ–∫—Ç–µ results.poseLandmarks –±—É–¥—É—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫ (–≥–æ–ª–æ–≤–∞, —Ä—É–∫–∏, –Ω–æ–≥–∏ –∏ —Ç.–¥.)
    console.log("–ü–æ–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", results.poseLandmarks);

    // 10. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –∏ –Ω–∞—á–∏—Å–ª—è—Ç—å –æ—á–∫–∏
    if (results.poseLandmarks) {
      // –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–Ω—è–ª —Ä—É–∫—É ‚Äî –Ω–∞—á–∏—Å–ª–∏—Ç—å –æ—á–∫–∏
      const rightWrist = results.poseLandmarks[16]; // –¢–æ—á–∫–∞ 16 = –ø—Ä–∞–≤–∞—è –∫–∏—Å—Ç—å
      if (rightWrist.y < 0.5) {
        console.log("–¢—ã –ø–æ–¥–Ω—è–ª –ø—Ä–∞–≤—É—é —Ä—É–∫—É! +10 –æ—á–∫–æ–≤ üéâ");
      }
    }
  });

  // 11. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É, —á—Ç–æ–±—ã –≤ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ Pose
  const camera = new Camera(videoElement, {
    onFrame: async () => {
      await pose.send({ image: videoElement }); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–¥—Ä –≤ MediaPipe
    },
    width: 640,
    height: 480
  });

  // 12. –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
  camera.start();
}
